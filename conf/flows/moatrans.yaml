moatrans:
  orchestrator: Selector
  name: Mixture of Agents directed chat (trans journalists criteria)
  save: ${save}

  steps:
    - id: MANAGER
      name: "👔 Manager"
      agent_obj: ${ui}
      num_runs: 1
      description: Your manager, supervisor, and final approver. Should be consulted if more information is needed, when approval is required on a final answer, or to check whether there are further questions once an answer has been given.
      inputs:
        prompt: prompt

    - id: HOST
      name: "🎯 Host"
      description: Your role, facilitating the discussion and directing questions to those best placed to answer. You have access to some tools that you can run directly if required.
      agent_obj: HostAgent
      num_runs: 1
      parameters:
        template: panel_host
        model: sonnet
      inputs:
        participants: participants
        context: context
        history: history
        prompt: prompt
        record: record
        description: >
          The purpose of this conversation is assess a single piece of content. You are the HOST.
          Unless the MANAGER directs you otherwise, the standard approach is for you to:
            1. Ask the JUDGES to review content according to their specific criteria.
            2. Call on other ANALYSTS to provide feedback or additional context.
            3. Ask the SYNTHESISERS to reconcile the draft answers provided so far.
            4. Call on the EVALUATORS to outline unresolved areas of disagreement among participants.
            5. For EACH main area of disagreement in turn, solicit input from all ANALYSTS to resolve.
            6. Once all issues have been discussed in full (and before the discussion becomes repetitive or off-topic), you should call on the SYNTHESISERS again to produce a set of final proposed answers.
            7. Call a VOTE to identify the preferred answer. 
            8. Ask the INTROSPECTOR to review the discussion and provide feedback on the process.
            9. Ask the MANAGER to approve the final answers.
          Remember that each participant is an expert with a well defined role. Do not tell them what to look for or explain how to do their job. It is sufficient that you call upon them to speak.

    - id: FETCH
      name: 🔍 fetch
      agent_obj: Fetch
      description: A TOOL to retrieve the content of URLs and stored RECORDS required for the discussion.
      data:
        - name: tja_train
          type: file
          path: gs://prosocial-dev/data/tja_train.jsonl
          index:
            - record_id
      inputs:
        prompt: prompt

    - id: JUDGE
      name: "⚖️ Judge"
      description: Expert analysts, particularly suited to assess content with subject matter expertise.
      agent_obj: LLMAgent
      num_runs: 2
      variants:
        template: judge
        model: ${llms.judgers}
        criteria:
          - trans_simplified
          - cte
          - tja
          - glaad
          - hrc
          - trans_factored
        formatting: json_rules
      inputs:
        record: record

    - id: ANALYST
      name: "🧑‍💻 Analyst"
      description: Get feedback from a team of analysts, responsible for identifying potential mistakes (Required step before synthesising results).
      agent_obj: LLMAgent
      num_runs: 1
      variants:
        template: feedback
        model: ${llms.general}
      inputs:
        history: history

    - id: SYNTHESISER
      name: "🎨 Synthesiser"
      agent_obj: LLMAgent
      description: Team leaders, responsible for synthesizes diverging draft answers from participants, taking into account feedback and other relevant information already provided.
      num_runs: 1
      variants:
        model: ${llms.synthesisers}
        template: synthesise_judger
        criteria:
          - trans_simplified
        formatting: json_rules
      inputs:
        record: record
        instructions: >
          Carefully apply EACH of the CRITERIA in order and provide a COMPLETE and SPECIFIC explanation about whether the particular rule has been violated and how. Use quotes from the content where necessary to support your analysis.
        answers: JUDGE
        feedback: feedback

    - id: EVALUATOR
      name: "📊 Evaluator"
      agent_obj: LLMAgent
      num_runs: 1
      description: Prepares analysis of the discussion and differences between draft answers (Required step after synthesizing a response).
      variants:
        template: differences
        model: gemini2flashthinking
        criteria: >
          Evaluate how well the provided content aligns with the rules.
      inputs:
        content: content
        answers:
          - JUDGE
          - SYNTH
        feedback: feedback

    # - name: 🔮 introspector
    # id: INTROSPECTOR
