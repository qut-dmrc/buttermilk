moa:
  orchestrator: Selector
  name: Mixture of Agents directed chat (trans journalists criteria)
  save: ${save}

  steps:
    - id: MANAGER
      name: "👔 Manager"
      agent_obj: ${ui}
      num_runs: 1
      description: Your manager, supervisor, and final approver. Should be consulted if more information is needed, when approval is required on a final answer, or to check whether there are further questions once an answer has been given.
      inputs:
        prompt: prompt

    - id: HOST
      name: "🎯 Host"
      description: Your role, facilitating the discussion and directing questions to those best placed to answer. You have access to some tools that you can run directly if required.
      agent_obj: HostAgent
      num_runs: 1
      parameters:
        template: panel_host
        model: sonnet
      inputs:
        participants: participants
        context: context
        history: history
        prompt: prompt
        record: record
        description: >
          The purpose of this conversation is assess a single piece of content. The content may be provided directly,
          or it may be referred to by a RECORD_ID or URL, in which case you should ask the FETCH agent to retrieve
          the full RECORD. Each JUDGE is an expert analyst with  extensive subject matter expertise. They bring their own 
          set of criteria to apply and will provide draft inputs into the conversation. Other ANALYSTS will assist 
          where they are able to contribute. The group will work as a team to develop a final answer, which will then 
          be submitted to the MANAGER for approval. The MANAGER may step in at any time to refocus or halt the 
          conversation. You, the HOST, will direct the conversation, allowing participants to contribute where they have 
          particular expertise. Each participant is an expert; do not tell them how to do their job, it is sufficient to call
          upon them to speak. Once initial responses have been received, the HOST will ask a SYNTHESISER to prepare an 
          integrated answer. The HOST will then ask an EVALUATOR to outline common areas of agreement and unresolved areas of 
          disagreement among participants. The HOST will then break the discussion down into discrete components, tackling 
          each area of disagreement one at a time. When an issue has been adequately considered (and before the
          discussion becomes repetitive or off-topic), the HOST will once again ask a SYNTHESISER to prepare one or more 
          consolidated answers and will then call a VOTE to identify the preferred answer. The HOST will repeat this process
          until all discrete components of the issue have been discussed. The HOST will then once again ask a SYNTHESISER to
          provide a set of draft overall answers and call a VOTE to identify the best answer. The HOST will then ask the 
          INTROSPECTOR to review the discussion before submitting to the MANAGER for approval.

    - id: FETCH
      name: 🔍 fetch
      agent_obj: Fetch
      description: A TOOL to retrieve the content of URLs and stored RECORDS required for the discussion.
      data:
        - name: tja_train
          type: file
          path: gs://prosocial-dev/data/tja_train.jsonl
          index:
            - record_id
      inputs:
        prompt: prompt

    - id: JUDGE
      name: "⚖️ Judge"
      description: Expert analysts, particularly suited to assess content with subject matter expertise.
      agent_obj: LLMAgent
      num_runs: 2
      variants:
        template: judge
        model: ${llms.judgers}
        criteria:
          - trans_simplified
          - cte
          - tja
          - glaad
          - hrc
          - trans_factored
        formatting: json_rules
      inputs:
        record: record

    - id: ANALYST
      name: "🧑‍💻 Analyst"
      description: Get feedback from a team of analysts, responsible for identifying potential mistakes (Required step before synthesising results).
      agent_obj: LLMAgent
      num_runs: 1
      variants:
        template: feedback
        model: ${llms.general}
      inputs:
        history: history

    - id: SYNTHESISER
      name: "🎨 Synthesiser"
      agent_obj: LLMAgent
      description: Team leaders, responsible for synthesizes diverging draft answers from participants, taking into account feedback and other relevant information already provided.
      num_runs: 1
      variants:
        model: ${llms.synthesisers}
        template: synthesise_judger
        criteria:
          - trans_simplified
        formatting: json_rules
      inputs:
        record: record
        instructions: >
          Carefully apply EACH of the CRITERIA in order and provide a COMPLETE and SPECIFIC explanation about whether the particular rule has been violated and how. Use quotes from the content where necessary to support your analysis.
        answers: JUDGE
        feedback: feedback

    - id: EVALUATOR
      name: "📊 Evaluator"
      agent_obj: LLMAgent
      num_runs: 1
      description: Prepares analysis of the discussion and differences between draft answers (Required step after synthesizing a response).
      variants:
        template: differences
        model: gemini2flashthinking
        criteria: >
          Evaluate how well the provided content aligns with the rules.
      inputs:
        content: content
        answers:
          - JUDGE
          - SYNTH
        feedback: feedback

    # - name: 🔮 introspector
    # id: INTROSPECTOR
