
creek:
  __target__: Creek
  flows:
    hate_full:
      - __target__: MultiFlowOrchestrator
        source: api creek hate judger
        flow:
          name: judger
          num_runs: 1
          concurrent: 20
          agent: 
            name: lc
            template: judge
            criteria: criteria_ordinary
            formatting: json_rules
            model:
              - haiku
              - gpt4o
              # - llama31_70b
              # - sonnet
              # - gemini15pro
          parameters:
      - __target__: MultiFlowOrchestrator
        source: api creek hate synth
        flow:
          name: judger
          num_runs: 1
          concurrent: 20
          agent: 
            name: lc
            template: judge
            criteria: criteria_ordinary
            formatting: json_rules
            model:
              - haiku
              - gpt4o
              # - llama31_70b
              # - sonnet
              # - gemini15pro
          parameters:
      - flow: synth
        num_runs: 1
        concurrent: 20
        agent: 
          name: lc
          template: synthesise
          instructions: judge
          criteria: criteria_ordinary
          formatting: json_rules
          model:
            - haiku
        parameters:
          answers: answers
          meta: meta
        data:
          answers:
            id: judger.job_id
            model: judger.parameters.model
            criteria: judger.agent_info.template_vars.criteria
            template: judger.agent_info.template
            reasons: judger.outputs.reasons
          judger:
            name: previous runs
            type: job
            dataset: dmrc-analysis.toxicity.flow
            max_records_per_group: 2
            agg: true
            filter:
              agent_info.flow: judger
              outputs.reasons: [NOTNULL]
              parameters.model:
                - gpt4o
                - sonnet
            join:
              record_id: record.record_id
            group:
              flow: agent_info.flow
              template: agent_info.template
              criteria: agent_info.template_vars.criteria
              model: parameters.model
            columns:
              meta:
                flow: agent_info.flow
                template: agent_info.template
                criteria: agent_info.template_vars.criteria
                model: parameters.model
                prediction: outputs.prediction
                labels: outputs.labels
                confidence: outputs.confidence
                timestamp: timestamp