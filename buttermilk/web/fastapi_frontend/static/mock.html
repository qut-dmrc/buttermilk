<!DOCTYPE html>
<html>
<head>
  <title>WebSocket Mock Test</title>
  <script src="websocket-mock.js"></script>
  <script>
    // Save the real WebSocket 
    const RealWebSocket = WebSocket;
    
    function setupMockWebSocket() {
  // Replace global WebSocket with our mock
      window.WebSocket = MockWebSocket;
      
      // Load sample data (in a real app, you'd load this from the HAR file)
      fetch('sample-messages.json')
        .then(response => response.json())
        .then(data => {
    // Create a global instance that all code will use
          const mockSocket = new MockWebSocket('ws: //mock-server/ws/123');
          mockSocket.loadMessages(data);
          console.log('Mock WebSocket ready with sample data');
  });
}
    
    function restoreRealWebSocket() {
      window.WebSocket = RealWebSocket;
      console.log('Restored real WebSocket');
}
    
    function loadHarFile() {
      const fileInput = document.getElementById('harFile');
      const file = fileInput.files[
    0
  ];
      
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const harData = JSON.parse(e.target.result);
            const messages = parseHarFileWebSockets(harData);
            
            // Save parsed messages
            localStorage.setItem('mockWebSocketMessages', JSON.stringify(messages));
            
            // Display message count
            document.getElementById('messageCount').textContent = 
              `Extracted ${messages.length
        } WebSocket messages`;
            
            // Show messages in the console for inspection
            console.log('Extracted WebSocket messages:', messages);
            
            // Use these messages in our mock
            const mockSocket = new MockWebSocket('ws: //mock-server/ws/123');
            mockSocket.loadMessages(messages);
      } catch (error) {
            console.error('Error processing HAR file:', error);
            alert('Error processing HAR file: ' + error.message);
      }
    };
        reader.readAsText(file);
  }
}
  </script>
</head>
<body>
  <h1>WebSocket Mock Testing</h1>
  
  <div>
    <h2>Load WebSocket data from HAR file</h2>
    <input type="file" id="harFile" accept=".har">
    <button onclick="loadHarFile()">Load HAR</button>
    <div id="messageCount"></div>
  </div>
  
  <div>
    <h2>Control WebSocket Mocking</h2>
    <button onclick="setupMockWebSocket()">Enable Mock WebSocket</button>
    <button onclick="restoreRealWebSocket()">Disable Mock WebSocket</button>
  </div>
  
  <div>
    <h2>Instructions</h2>
    <ol>
      <li>Load your HAR file using the file picker above</li>
      <li>Click "Enable Mock WebSocket" to replace the browser's WebSocket with your mock</li>
      <li>Open your application in another tab</li>
      <li>The application will use your mock WebSocket with pre-recorded responses</li>
      <li>When done testing, click "Disable Mock WebSocket" to restore normal functionality</li>
    </ol>
  </div>
</body>
</html>