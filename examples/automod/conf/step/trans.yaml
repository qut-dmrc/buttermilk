- flow: judger
  num_runs: 1
  concurrent: 20
  agent: 
    name: lc
    template: judge
    criteria: 
      - trans_cte
      - trans_tja
      - trans_glaad
      - trans_hrc
      - trans_simplified
      - trans_factored
    formatting: json_rules
    model:
      - haiku
      # - o1-preview
      - llama31_70b
      - gpt4o
      - sonnet
      - gemini15pro
  parameters:
    record_id: record_id
    content: content
    title: title
  data:
- flow: synth
  num_runs: 1
  concurrent: 20
  agent: 
    name: lc_judge
    template: synthesise
    criteria: 
      - trans_simplified
    formatting: json_rules
    model:
      - haiku
      - gpt4o
      - sonnet
      - gemini15pro
  parameters:
    answers: answers
    meta: meta
  data:
    judger:
      name: previous runs
      type: job
      dataset: dmrc-analysis.toxicity.flow
      max_records_per_group: 1
      filter:
        agent_info.flow: judger
        outputs.reasons: [NOTNULL]
      join:
        record_id: record.record_id
      group:
        flow: agent_info.flow
        template: agent_info.template
        criteria: agent_info.template_vars.criteria
        model: parameters.model
      columns:
        answers:
          id: job_id
          model: model
          criteria: criteria
          template: template
          flow: flow
          reasons: outputs.reasons
        meta:
          flow: agent_info.flow
          template: agent_info.template
          criteria: agent_info.template_vars.criteria
          model: parameters.model
          prediction: outputs.prediction
          labels: outputs.labels
          confidence: outputs.confidence
          timestamp: timestamp

- flow: eval
  num_runs: 1
  concurrent: 20
  agent: 
    name: lc
    template: differences
    criteria: 
      - trans_simplified
    model:
      - haiku
      - gpt4o
      - sonnet
      - gemini15pro
  parameters:
    answers: answers
    meta: meta
  data:
    judger:
      name: previous runs and synth
      type: job
      dataset: dmrc-analysis.toxicity.flow
      max_records_per_group: 1
      filter:
        agent_info.flow:
          - judger
          - synth
      join:
        record_id: record_id
      group:
        record_id: record.record_id
        model: parameters.model
        flow: agent_info.flow
        template: agent_info.template
        criteria: agent_info.template_vars.criteria
      columns:
        answers:
        id: job_id
        flow: agent_info.flow
        reasons: outputs.reasons
        model: model
        criteria: criteria
        template: template
        meta:
          template: templaet
          criteria: agent_info.template_vars.criteria
          model: parameters.model
          prediction: outputs.prediction
          labels: outputs.labels
          confidence: outputs.confidence
          timestamp: timestamp
- flow: analysis
  data:
    eval:
      max_records_per_group: -1
      name: eval
      type: job
      dataset: dmrc-analysis.toxicity.flow
      filter:

      join:
        record_id: record.record_id
      agg: false
      group:
        id: job_id
        flow: agent_info.flow
        criteria: agent_info.template_vars.criteria
      columns:
        labels: outputs.labels
        reasons: outputs.analysis
        model: parameters.model
        criteria: criteria
        template: agent_info.template
        prediction: outputs.prediction
        confidence: outputs.confidence
        timestamp: timestamp
